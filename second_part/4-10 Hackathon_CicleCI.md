# 4.10 ハッカソン( CIツール導入 )

## 4.10.1 CIツール(CircleCI)を導入してみよう

カリキュラム 1.5.10 「継続的インテグレーションとは」で紹介したCIツール、CircleCIを実際に導入して、CIを回してみましょう。

## 4.10.2 CircleCIの導入方法

### CircleCIに登録する

まずはCircleCI ( https://circleci.com/ )にログインしてみましょう。

CircleCIへの登録、ログインにはGitHubアカウント、もしくはBitbucketのアカウントを利用します。お使いのGitHubのアカウントでログインしてみましょう。

### 新規プロジェクトを設定する

「Project」タブからプロジェクト一覧画面を開き、「Add Project」ボタンを押してみましょう。

あなたが管理しているリポジトリの一覧が表示されましたか？表示されない場合、リポジトリの管理権限がない可能性があります。リポジトリの管理者に依頼して、リポジトリ側の権限を調整してもらいましょう。

プロジェクト一覧から、CircleCIのセットアップをしたいプロジェクトを選び、「Setup project」ボタンを押すと、以下のような画面が表示されます。

![プロジェクト設定画面](images/4-10-1-CI1.png "プロジェクト設定画面")


#### Platformの選択

**Platform** は2.0を選択しましょう。

2.0では実行環境がCircleCIが提供するUbuntu環境からDockerコンテナへ変更されました。
この変更により、旧来はCircleCIの実行ごとに必要だった依存関係のインストールなどを、予めセットアップ済みのDockerコンテナを利用するなどして短縮することができるようになりました。

また、2.0では **Workflow** という新たな概念が登場しました。

Workflowは処理を分割して、実行順序や依存を定義することができます。これにより、今までは直列で実行されていたCIの実行を並列実行したり、テストがパスした場合はデプロイを行う、などの設定が柔軟にできるようになりました。

例) RuboCopとRSpecは並列実行可能なので、並列に実行してビルド時間を短縮する。など

#### Languageの選択

**Language**はRubyを選択してください。

CircleCIではRubyを始め、JavaやPython、Goなど様々な言語に対応しています。

基本的には後続のNext Steps欄で表示される設定ファイルのスニペットが選択した言語用に変わるだけですので、選択肢にない言語を利用したシステムであっても、セットアップ済みのDockerコンテナさえ用意できればCIの実行が可能です。

#### 設定ファイルのPush

Next Stepsの説明通りにリポジトリに設定ファイルをリポジトリに登録、Pushしてください。

CircleCIのRubyのデフォルト設定では、rspecを実行して結果を保存するような設定がすでになされています。

表示されている設定ファイルのサンプルの内容をコピーし、CircleCIを実行するリポジトリ直下に「.circleci」というディレクトリを作成、その配下にconfig.ymlというファイル名で保存します。

追加が終わったら、pushしておきましょう。もし、フィーチャーブランチ上で作業している場合は、一旦PRをしmasterにマージしましょう。

#### Start Building!

ここまでの作業がすんだら、Start Buildingボタンを押してください。

これで、CircleCIでビルドが始まります。
もしビルドが失敗した場合は、ビルドログを見て解決してみましょう。

以降はGitHub上にPushされる度にCircleCIが検知して、テストを実行します。

## 4.10.3 アドバイス

### CircleCIをもっと活用してみよう

CircleCIは設定次第で非常に柔軟で強力なツールになります。
例えば、masterブランチに対するpush(つまりPRのマージ)が行われたときだけ、ステージング環境に自動デプロイを行う、といったことも可能です。

CIツールをどんどん活用して、開発スピードを高速化しましょう。

### ほかのツールを組み合わせる

開発スピードを速めるためのサービスは他にもあります。例えば、CircleCIと同じような形で静的コード解析サービスを提供する「SideCI」( https://sideci.com/ )などはすぐ導入可能です。

こういったツールは現在かなりの数がありますので、ツールの特徴をしっかりと理解して、どんどん活用していきましょう。
