# 4.7 ハッカソン（バッチ処理の利用）

## 4.7.1 バッチ処理の利用

カリキュラム2.8で学習したバッチ処理を開発中のアプリケーションに組み込んでみましょう。

バッチ処理にはいろいろな使い道があります。たとえば、利用者へのお知らせメール配信機能を実装すれば、登録したユーザをサービスにつなぎ止める施策になるでしょう。開発チームにユーザー数の増減を定期的に通知するようにしておけば、あなたのサービスがいきなり大流行したときにも素早く対応ができるかもしれませんね。

## 4.7.2 ポイント

### ログはきちんと出力する

ログを出力していれば「バッチ処理がいつの間にか正常に動かなくなっていて、いつから動かなくなっていたのかもよく分からない」といった面倒な問題を避けることができます。先々の運用を楽にするため、できるだけ丁寧にログを出力しておきましょう。

### 自動テストも忘れずに

バッチ処理は修正漏れが起こりがちです。「Modelの実装を変更したが、バッチ処理のコードの修正を忘れていたので本番環境でエラーが起きてしまった」というトラブルを避けるためにも、テストは実装しておきましょう。

## 4.7.3 発展事項

### エラーの自動通知

丁寧にログを出力していても、エラーの発生にすぐに気づけなければ対応が遅れてしまいます。バッチ処理でエラーが発生したとき、メールやチャットサービスに自動的に通知されるようにしてみましょう。

### 本番環境とのデータ量の差に注意

めでたくサービスが成長すると、本番環境には大量のデータが蓄積されることになります。開発環境の少量のデータでは問題のなかった処理が、本番環境では予想外の負荷を与えてしまうこともあります。本番環境とのデータ量の差に注意しましょう。

### ログ溢れに注意

運用が安定すると、ログを確認する頻度も低下していきます。サーバのディスクにログを書き出している場合、ディスクの空き容量がなくなってサービスが停止してしまうことがありますので注意が必要です。長期的に運用するなら、定期的に古いログを削除・圧縮する仕組みを導入したり、外部のデータログ収集サービスを利用することも検討してみましょう。

### ログ出力のためのgem

Rubyの標準の`Logger`クラスやRailsの`ActiveSupport::Logger`クラスの他にも、ログ出力のための便利な機能を備えたgemはいくつか公開されています。関心があれば調べて見ましょう。
