## 2.1　Ruby基礎

### 2.1.1　Rubyの基本的な知識
#### Rubyとは

まつもとゆきひろ(Matz)氏によって開発されたプログラミング言語です。Rubyはオブジェクト指向スクリプト言語です。  
オブジェクト指向とはプログラム内のすべての概念を「もの」として扱います。「もの(オブジェクト)」は、データ(属性や状態)と振る舞い(メソッドや関数)を含み、それらの相互作用によってプログラムが構築されます。 
たとえば、オブジェクト指向プログラミングの考え方では、車や犬、人間などの現実世界の物体をプログラム内のオブジェクトとしてモデル化します。それぞれのオブジェクトは、特定の属性（色やサイズなど）を持ち、特定の操作（走る、鳴く、話すなど）を実行することができます。   
スクリプト言語とは記述したプログラムをすぐに実行、確認ができる言語です。  
シンプルで読みやすい構文を持ち、柔軟な設計ができるのが特徴です。

__コードのシンプルさ__  
 Rubyの構文はシンプルかつ柔軟であり、自然言語に近い記法を採用しています。これにより、初心者から上級者まで幅広いユーザーに親しまれています。  

`irb`とコマンドを入力して、対話型シェルを動かしてみましょう。  
```sh
$ irb
irb(main):001>
```

シェルが起動したら`"Hello world!"`を出力してみましょう。
```rb
puts "Hello world!"
```

```rb
# 変数の宣言と出力

name = "Alice"
age = 30
puts "名前: #{name}, 年齢: #{age}"

#=> 名前: Alice, 年齢: 30
```

以下のコマンドを実行してください。  
```sh
$ mkdir ruby
$ cd ruby
$ touch ruby.rb
```

これで`ruby`ディレクトリと`ruby.rb`ファイルが作成できました。  
`ruby.rb`に先ほど同様のコードを書きましょう。  
```rb
# ruby.rb

name = "Alice"
age = 30
puts "名前: #{name}, 年齢: #{age}"
```

実行します。

```sh
$ ruby ruby.rb
名前: Alice, 年齢: 30
```

このようにすることでRubyのプログラミングを実行することが出来ます。 

#### (1)　 __変数__  
##### (1)-1　変数について  
Rubyにはいくつかのデータ型があります。主なものを紹介します。    
1. 数値型(Numeric)：
    - 整数(Integer)：例えば、`1`, `100`, `-5`など
    - 浮動小数点数(Float)：例えば、`3.14`, `2.71828`など

2. 文字列型 (String): 一連の文字。ダブルクォート (") もしくはシングルクォート (') で囲みます。
    - 例えば、`"Hello, world!"`

3. 真偽値型(Boolean)：真(`true`)または偽(`false`)の値を持ちます。

4. 配列型(Array)：複数の要素を順序付けて格納します。角括弧(`[]`)で囲み、要素はカンマで区切ります。
    - 例えば、`[1, 2, 3]`

5. ハッシュ型(Hash)：キーと値のペアを格納します。波括弧(`{}`)で囲み、キーと値の間は`=>`で結びます。
    - 例えば、`{ "name" => "John", "age" => 30 }`

6. シンボル型(Symbol)：文字列と似ていますが、イミュータブルであり、同じシンボルは常に同じオブジェクトを指します。コロン(`:`)を使って定義します。
    - 例えば、`:name`

これらのデータ型を適切に組み合わせることで、Rubyプログラムを記述し、柔軟で強力な動作を実現できます。また、Rubyはオブジェクト指向言語であるため、全てのデータ型はオブジェクトです。それぞれの型はメソッドを持ち、それによって振る舞いを変更できます。  

Rubyは動的型付け言語であるため、全ての変数・定数に型宣言をする必要はありません。  
Rubyにおける変数には、ローカル変数・グローバル変数・インスタンス変数・クラス変数・疑似変数の5種類があります。  

1. ローカル変数：メソッド内で定義され、そのメソッド内でのみ有効な変数です。
2. グローバル変数：$記号で始まる変数で、どこからでもアクセスできる変数です。
3. インスタンス変数：@記号で始まる変数で、インスタンス(オブジェクト)の状態を表すために使用されます。インスタンスごとに異なる値を持つことができます。
4. クラス変数：@@記号で始まる変数で、クラス内のすべてのインスタンスで共有される変数です。
5. 疑似変数：self、nil、true、falseなどの特別な意味を持つ予約された変数です。これらの変数の値はプログラムの実行中に変更できません。

#####	①　ローカル変数  
・変数名の先頭が、小文字アルファベットか_（アンダースコア）だとローカル変数になる  
```rb
num = 100
_num = 200

puts num   #=> 100
puts _num  #=> 200
```			

・メソッドやオブジェクトの壁を超えて参照することは出来ない  
```rb
num = 100

def output
	puts num
end

output  #=> エラー
```
#####	②　グローバル変数  
・変数名の先頭が、$だとグローバル変数になる
```rb
$num = 100

puts $num  #=> 100
```
・メソッドやオブジェクトの壁を超えて、プログラム中であればどこからでも参照出来る  
```rb
$num = 100

def output
	puts $num
end

output  #=> 100
```
#####	③　インスタンス変数  
・変数名の先頭が、@だとインスタンス変数になる  
・インスタンス毎に独立している  
```rb
@num = 100

puts @num  #=> 100
```
・詳細はクラスの項目で解説

#####	④　クラス変数  
・変数名の先頭が、@@だとクラス変数になる  
・クラス内で共有されている  
```rb
@@num = 100

puts @@num  #=> 100
```
・詳細はクラスの項目で解説  

#####	⑤　疑似変数  
・Ruby側で用意された特殊な変数  
・上書きは不可  
```rb
# 真の値
true

# 偽の値
false

# 何もない状態を表す, 他言語でのnullのような扱い
nil
```

#### 変数の有効範囲について
変数の有効範囲のことをスコープと呼びます。主なスコープは以下の通りです。  
1. ローカルスコープ：ローカル変数は通常、その変数が定義されたブロック内でのみ有効です。メソッドの中で定義された変数は、そのメソッド内でのみ有効です。  
```rb
def my_method
  x = 10
  puts x
end

my_method   # => 10
puts x      # エラー: `x` は定義されていません
```

2. グローバルスコープ：グローバル変数はどこからでもアクセスできます。グローバル変数はどこからでもアクセスできるため、プログラムが複雑になり保守性やバグが増加してしまいます。そのため、グローバル変数の使用は極力避けるべきです。
```rb
$global_var = 20

def my_method
  puts $global_var
end

my_method   # => 20
```

3. インスタンススコープ：インスタンス変数は、そのインスタンスの中でのみ有効です。
```rb
class MyClass
  def initialize
    @instance_var = 30
  end

  def get_instance_var
    puts @instance_var
  end
end

obj = MyClass.new
obj.get_instance_var   # => 30
```

4. クラススコープ：クラス変数はそのクラスとそのサブクラスのインスタンス間で共有されます。
```rb
class MyClass
  @@class_var = 40

  def self.get_class_var
    puts @@class_var
  end
end

MyClass.get_class_var   # => 40
```

#### (2) __定数__  
##### (2)-1　定数について  
定数とは、変更されない値を示しているため変数とは異なります。  

・名前の先頭を大文字にすることで定義出来る
```rb
MAX = 50

puts MAX  #=> 50
```
・メソッド内では定義できない
```rb
def output_max
	MAX = 50
	puts MAX
end

puts output_max  #=> エラー
```
##### (2)-2　Rubyでの定数の扱い  
Rubyの定数は、定義後であっても値を再代入することが出来ます。  
もし変更不可な値として扱いたいのであれば、`freeze`メソッドを使用することで実現できます。  
`freeze`メソッドは後に出てくる配列やハッシュを定数化するときなどにも使います。ただしこちらも変更は不可になりますが、値を再代入することは出来ます。  

```rb
MAX1 = 50
MAX1 = 100  #=> 警告が出るが代入は可能
puts MAX1   #=> 100

# freezeしても再代入は可能である
MAX2 = 50.freeze
MAX2 = 100  #=> 警告が出るが代入は可能
puts MAX2   #=> 100

# freezeすると値の変更が不可となる
MAX3 = ”a”.freeze
MAX3.replace("b") #=> RuntimeError: can't modify frozen String
```


#### (3)　__真偽値__  
##### (3)-1　真の値  
Rubyでは、`false`と`nil`以外の全てが真の値として認識されます。  
一応、真の値の代表という扱いで`true`が用意されています。  
以下は真偽値として考えた場合には全て真になります。（!!は真偽値に変換するためのもの）  
```rb
puts true       #=> true

puts !!0        #=> true

puts !!"false"  #=> true
```

#####	(3)-2　偽の値  
Rubyで偽の値として認識されるのは、`false`と`nil`のみです。  
```rb
puts false  #=> false

puts !!nil  #=> false
```
####	(4)　__配列__  
#####	(4)-1　初期化・定義
配列は順序付けられた要素の集合です。  
`[]`で囲んで定義します。

```rb
# 初期化
arr = []
arr = Array.new

# 定義
fruits = ["apple", "banana", "lemon"]
```
#####	(4)-2　要素の取得
```rb
fruits = ["apple", "banana", "lemon"]

# インデックスを指定して取得（ 0 ～ ）
puts fruits[0]   #=> apple
puts fruits[1]   #=> banana

# マイナスのインデックスも指定出来る
# インデックスは配列の最後から数える（ -1 ～ ）
puts fruits[-1]  #=> lemon
puts fruits[-2]  #=> banana
```
#####	(4)-3　要素の追加
```rb
fruits = ["apple"]

# どちらも配列の最後に要素を追加する
fruits.push("banana")
p fruits  #=> ["apple", "banana"]

fruits << "lemon"
p fruits  #=> ["apple", "banana", "lemon"]
```
####	(5)　__ハッシュ（連想配列）__  
#####	(5)-1　初期化・定義
ハッシュはキーと値のペアの集合です。  
`{}`で囲んで定義します。

```rb
# 初期化
hash = {}
hash = Hash.new

# 基本の定義方法
fruits = {"apple" => 100, "banana" => 60, "lemon" => 150}

# キーをシンボルで指定する場合の定義方法（推奨）
fruits = {apple: 100, banana: 60, lemon: 150}
```
#####	(5)-2　要素の取得
```rb
fruits = {apple: 100, banana: 60, lemon: 150}

# キーを指定して取得
fruits[:apple]  #=> 100
```
#####	(5)-3　要素の追加
```rb
fruits = {apple: 100}

fruits[:banana] = 60
p fruits  #=> {:apple=>100, :banana=>60}
```


__【問題】__  
1. 変数`name`に文字列で自分の名前を代入し、それを出力するコードを書いてください。  

2. グローバル変数`age`に値`30`を代入し、それを出力するコードを書いてください。  

3. インスタンス変数`height`に値`180`を代入し、それを出力するコードを書いてください。  

4. クラス変数`count`に値`10`を代入し、それを出力するコードを書いてください。

5. 真偽値`true`を出力するコードを書いてください。

6. 配列`numbers`に要素`1`, `2`, `3`を格納し、それを出力するコードを書いてください。

7. ハッシュ`person`にキーとして`name`、値として自分の名前を追加し、そのハッシュから`name`の値を出力するコードを書いてください。

8. 定数`PI`に値`3.14`を代入し、それを出力するコードを書いてください。

9. 真偽値`false`を出力するコードを書いてください。

10. 配列`colors`に要素`"red"`, `"blue"`, `"green"`を格納し、その要素数を出力するコードを書いてください。


__【解答】__  
1. 解答例
```rb
name = "Alice"
puts name
```

2. 解答例
```rb
$age = 30
puts $age
```

3. 解答例
```rb
@height = 180
puts @height
```

4. 解答例
```rb
class Sample
  @@count = 10
  puts @@count
end
```

5. 解答例
```rb
puts true
```

6. 解答例
```rb
numbers = [1, 2, 3]
puts numbers
```

7. 解答例
```rb
person = {}
person[:name] = "Bob"
puts person[:name]
```

8. 解答例
```rb
PI = 3.14
puts PI
```

9. 解答例
```rb
puts false
```

10. 解答例
```rb
colors = ["red", "blue", "green"]
puts colors.length
```
