## 11.1.5 Ruby on Rails：ECサイトの開発 メール送信2

### 11.1.5.1 補足
⑦ ActionMailerの設定  
メールが送信できない場合にエラーを出せるように設定を変更します。デフォルトで存在している`config.action_mailer.raise_delivery_errors`が`false`になっていれば`true`に変更します。  
また、コードは上から順番に呼ばれていきます。そのため、以下のように編集することで`false`になっているものを`true`が再代入されます。

config/environments/development.rb
``` ruby
require "active_support/core_ext/integer/time"

Rails.application.configure do
         ・
      ~~ 中略 ~~
         ・
  config.action_mailer.raise_delivery_errors = true #追加
  config.action_mailer.delivery_method = :smtp
  config.action_mailer.smtp_settings = {
    address: 'smtp.gmail.com',
    port: 587,
    domain: 'gmail.com',
    user_name: ENV['MAIL_USER_NAME'],
    password: ENV['MAIL_PASSWORD'],
    authentication: 'plain',
    enable_starttls_auto: true
  }
end
```

⑧ 動作確認  
`OpenSSL::SSL::SSLError`のエラーが発生し、メールの送信ができないことがあります。本来はセキュリティの都合上、TLS設定をするのが良いのですが、今回はエラーを回避するためにそれらのチェックを省く設定を行います。  
以下のようにコードを修正してください。  

config/environments/development.rb
``` ruby
require "active_support/core_ext/integer/time"

Rails.application.configure do
         ・
      ~~ 中略 ~~
         ・
  config.action_mailer.raise_delivery_errors = true
  config.action_mailer.delivery_method = :smtp
  config.action_mailer.smtp_settings = {
    address: 'smtp.gmail.com',
    port: 587,
    domain: 'gmail.com',
    user_name: ENV['MAIL_USER_NAME'],
    password: ENV['MAIL_PASSWORD'],
    authentication: 'plain',
    openssl_verify_mode: 'none', #追加
    enable_starttls_auto: true    　
  }
end
```

動作の確認を行いますので`rails c`でコンソールを起動し、以下のコマンドを実行してください。

``` ruby
test = ToDoTask.new(title:"テスト", description:"プレビュー テスト", alert_mail_address:'自身のGmailアドレス')
TodoTaskMailer.registration_mail(test).deliver
```

いかがでしょうか。メールが受信されていれば成功です。